<html>
    <head>
        <!-- External libs -->
        <script src="js/extern/three.js"></script>
        <script src="js/extern/stats.min.js"></script>
        <script src="js/extern/dat.gui.min.js"></script>
        <script src="js/extern/shaders/ConvolutionShader.js"></script>
        <script src="js/extern/shaders/CopyShader.js"></script>
        <script src="js/extern/shaders/FXAAShader.js"></script>
        <script src="js/extern/shaders/VignetteShader.js"></script>
        <script src="js/extern/shaders/RGBShiftShader.js"></script>
        <script src="js/extern/postprocessing/EffectComposer.js"></script>
        <script src="js/extern/postprocessing/MaskPass.js"></script>
        <script src="js/extern/postprocessing/RenderPass.js"></script>
        <script src="js/extern/postprocessing/ShaderPass.js"></script>
        <script src="js/extern/postprocessing/BloomPass.js"></script>
        <script src="js/extern/require.js"></script>

        <!-- our stuff -->
        <script src="js/anim.js"></script>
        <script src="js/core.js"></script>
        <script src="js/seq.js"></script>
        <script src="js/shot.js"></script>
        <script src="js/geom/ribbon.js"></script>
        <script src="js/shots/warpSeries.js"></script>
        <script src="js/shots/warp_1.js"></script>
        <script src="js/shots/warp_2.js"></script>
        <script src="js/shots/warp_3.js"></script>
        <script src="js/shots/circleBlast_1.js"></script>
        <script src="js/shots/circleSpline_1.js"></script>
        <script src="js/shots/circleSpline_2.js"></script>
        <script src="js/shots/circleSpline_3.js"></script>
        <script src="js/shots/circleSpline_4.js"></script>
        <script src="js/shots/circleSpline_5.js"></script>
        <script src="js/shots/circleSeries.js"></script>
        <script src="js/shots/chase_1.js"></script>
        <script src="js/shots/intro.js"></script>

        <!-- curve assets -->
        <script src="curves/arrow.js"></script>
        <script src="curves/babe.js"></script>
        <script src="curves/flame.js"></script>
        <script src="curves/heart.js"></script>
        <script src="curves/star.js"></script>

    </head>
    <body style="margin: 0; padding:0;">
        <script>
            //
            // Main entry point
            //
            _audioReady = false;
            _glReady = false;

            function tryToPlay() {
                if (!_glReady) {
                    init();
                    _glReady = true;
                }
                //
                // If we're not ready to play, continue spinning
                // 
                if (!_audioReady || !_glReady) {
                    setTimeout(tryToPlay, 500);
                    return;
                }

                // run the demo, audio playback will kick off 
                // the animation.
                seq.play();
            }

            function beginPlaying() {
                // Track the actual start time for debugging
                var now = new Date().getTime();
                var trackTime = seq.audio.currentTime*1000;
                seq.audio._startTime =  now - trackTime;

                // Audio started, now start the animation
                animate();
            }

            window.onload = function() {
                tryToPlay();
            };

            document.onkeyup = function(e) {
                var ESC = 27,
                    K_LEFT = 37,
                    K_RIGHT = 39;

                if (e.keyCode == ESC) { 
                    if (seq.isPlaying()) {
                        seq.pause()
                    } else {
                        seq.play()
                    }
                }  else {
                    console.log("Time: " + seq.getTime() + "s" + 
                                ", key pressed: " + e.keyCode);
                }
            }

        </script>
        <audio id="soundtrack" 
                src="music/audio.mp3" 
                style="display: none" 
                oncanplay="_audioReady = true;"
                onplaying="beginPlaying();"></audio>
    </body>
</html>
